# Description
These tools ([jupyter notebooks](https://jupyter.org/) ) ingest data from the NOAA Hydrometeorological Design Studies Center ([HDSC](https://www.nws.noaa.gov/oh/hdsc/index.html)) and return unique, weighted excess rainfall events suitable for use in 2D hydraulic *rain-on-grid* models. This approach relies on:

  1. Meteorological data
  2. Random sampling
  3. Hydrologic transform
  4. Convolution algorithm for grouping

__NOTE__: [EventsTable](EventsTable.ipynb) is the primary notebook for developing excess precipitation scenarios and can be called by [*Papermill*](https://pypi.org/project/papermill/). Papermill is designed to act as a *manager* to maintain consistency in computation, and ensure cells are executed in order. *Manager* notebooks are designated with the `PM-` prefix. Executed notebooks should be saved as documentation of the inputs, outputs, and results for a given project location.

---

## Contents

- [__PrecipTable__](PrecipTable.ipynb): Retrieve NOAA Atlas 14 precipitation statisics for an Area of Interest (AOI).

- [__PM-EventsTable__](PM-EventsTable.ipynb): Manager notebook that executes `EventsTable` and/or `reEventsTable`.

- [__EventsTable__](EventsTable.ipynb): Calculates excess rainfall using area-averaged NOAA Atlas 14 precipitation data, temporal distributions, the curve number (CN)* transform, and a convolution reduction algorithm (grouping). The output is a set of unique, weighted excess rainfall time series.

- [__EventsTable_Stratified__](EventsTable_Stratified.ipynb): Calculates a stratified sample of runoff events given rainfall and maximum potential retention distributions. For each each event and corresponding return interval, the event weight, runoff value, maximum potential retention value, and rainfall value are calculated.

- [__reEventsTable__](reEventsTable.ipynb): Calculates the reduced excess rainfall given a user-specified stormwater removal rate and capacity. Given user-specified contributing areas (stormsheds), the lateral inflow hydrograhs are also calculated for each event.

- [__distalEventsTable__](distalEventsTable.ipynb): Calculates excess rainfall using updated randomized curve numbers and the original precipitation events calculated in `EventsTable.ipynb`. The events are combined using the groups determined during the convolution steps in `EventsTable.ipynb`. The `reEventsTable` notebook can be then be executed in order to calculate the reduced excess rainfall.

- [__JSON_to_DSS__](JSON_to_DSS.ipynb): Converts the JSON files generated by `PM-EventsTable` and/or `distalEventsTable` to a single DSS.

- [__MetadataExplorer__](MetadataExplorer.ipynb): Explores the metadata file created by `PM-EventsTable` or `distalEventsTable` during the excess rainfall calculations.

- [__Convolution_Parameters__](Convolution_Parameters.ipynb): Describes the test statistic and parameters used during the convolution step in the `EventsTable` notebook.

- `ProjectArea_ModelName_Pluvial_Parameters.xlsx `: Excel Workbook used to store the CN, stormwater removal rate and capacity, and information on lateral inflow domains for each pluvial domain within a pluvial model. This Workbook is called by `EventsTable`, `PM-EventsTable`, `distalEventsTable`, and `reEventsTable`.


*The ([CN Method](https://www.nrcs.usda.gov/Internet/FSE_DOCUMENTS/stelprdb1044171.pdf)) is currently the only transform method in use for this project. Other transforms are available and can be adopted into the tool with minor modifications.

---

## Workflow

1. Run [PrecipTable](PrecipTable.ipynb) in order to calculate the area-averaged precipitation frequency table for the specified durations as well as to determine the NOAA Atlas 14 volume and region.
    ```
      Inputs:
        1. A vector polygon of the area of interest, i.e. the pluvial domain.
        2. Optional/as needed: 
            - Precipitation event durations; the standard  durations are 6, 12, 24, and 96 hour.
            - The polygon's projection as a string if it cannot be determined automatically.
      Outputs:
        1. A spreadsheet with the area-averaged precipitation frequency table for each duration, along with the NOAA Atlas 14 volume and region numbers.
    ```
    
    
2. Run [PM-EventsTable](PM-EventsTable.ipynb) which executes [EventsTable](EventsTable.ipynb) in order to calculate excess rainfall events and [reEventsTable](reEventsTable.ipynb) to perform the stormwater reduction (optional).

    ```
      Inputs:
        1. PrecipTable.xlsx from step 1, which contains precipitation frequency tables and the NOAA Atlas 14 volume and region number. Note that the volume and region number may also be entered manually.
        2. Pluvial_Parameters.xlsx metadata file which contains the curve number and information on the stormwater infrastructure.
        4. Storm durations
        5. Filenames and paths for outputs
        6. EventsTable.ipynb

      Outputs:
        1. Precipitation statistics for each duration
        2. HTML copy of notebook
    ```